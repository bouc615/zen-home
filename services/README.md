# AI Service

ç®€æ´çš„ AI æœåŠ¡å®ç°ï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢ Vertex AI å’Œ OpenAI SDKã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
services/
â”œâ”€â”€ aiService.ts    # ä¸šåŠ¡é€»è¾‘å±‚ - ç»Ÿä¸€å…¥å£
â”œâ”€â”€ prompts.ts      # å…¬å…±ä¸šåŠ¡é€»è¾‘ - Prompt/Schema/æ ¼å¼åŒ–
â”œâ”€â”€ vertexAI.ts     # åŸºç¡€èƒ½åŠ›å±‚ - Vertex AI API
â”œâ”€â”€ openai.ts       # åŸºç¡€èƒ½åŠ›å±‚ - OpenAI API
â””â”€â”€ README.md       # æœ¬æ–‡æ¡£
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡é€»è¾‘å±‚ (aiService.ts)         â”‚
â”‚   - analyzeImage()                  â”‚
â”‚   - sendChatMessage()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¬å…±ä¸šåŠ¡é€»è¾‘            â”‚  â”‚  åŸºç¡€èƒ½åŠ›å±‚          â”‚
â”‚  (prompts.ts)           â”‚  â”‚  - vertexAI.ts      â”‚
â”‚  - Prompts              â”‚  â”‚  - openai.ts        â”‚
â”‚  - Schemas              â”‚  â”‚                     â”‚
â”‚  - æ ¼å¼åŒ–å‡½æ•°            â”‚  â”‚  çº¯ API è°ƒç”¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŒè´£åˆ’åˆ†

1. **aiService.ts** - ä¸šåŠ¡é€»è¾‘å±‚
   - ç»Ÿä¸€çš„å¯¹å¤–æ¥å£
   - è·¯ç”±åˆ°ä¸åŒçš„ AI æä¾›å•†
   - é”™è¯¯å¤„ç†å’Œ fallback

2. **prompts.ts** - å…¬å…±ä¸šåŠ¡é€»è¾‘
   - Prompt æ¨¡æ¿
   - Schema å®šä¹‰
   - æ•°æ®æ ¼å¼åŒ–å‡½æ•°
   - **æ— é‡å¤ä»£ç **

3. **vertexAI.ts** - Vertex AI åŸºç¡€èƒ½åŠ›
   - çº¯ç²¹çš„ API è°ƒç”¨
   - ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
   - å¯å¤ç”¨çš„åŸºç¡€å‡½æ•°

4. **openai.ts** - OpenAI åŸºç¡€èƒ½åŠ›
   - çº¯ç²¹çš„ API è°ƒç”¨
   - ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
   - å¯å¤ç”¨çš„åŸºç¡€å‡½æ•°

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. å›¾åƒè¯†åˆ« - æ”¯æŒå¤šç‰©å“è¯†åˆ«

```typescript
import { analyzeImage } from "./services/aiService";
import { ItemType } from "./types";

const result = await analyzeImage(base64Image, ItemType.FRIDGE);

// è¿”å›æ ¼å¼
{
  items: [
    { name: "ç‰›å¥¶", category: "ä¹³åˆ¶å“", expiryDate: "2025-12-10", ... },
    { name: "é¸¡è›‹", category: "è›‹ç±»", quantity: "12ä¸ª", ... }
  ],
  totalCount: 2
}
```

**ç‰¹æ€§:**
- âœ… è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ä¸­çš„**æ‰€æœ‰é£Ÿæ**
- âœ… ä¸ºæ¯ä¸ªé£Ÿææä¾›è¯¦ç»†ä¿¡æ¯ï¼ˆè¿‡æœŸæ—¥æœŸã€æ•°é‡ç­‰ï¼‰
- âœ… è¿”å›è¯†åˆ«åˆ°çš„é£Ÿææ€»æ•°
- âœ… æ”¯æŒè´­ç‰©å°ç¥¨æ‰¹é‡è¯†åˆ«
- âœ… å¤šä¸ªç‰©å“ï¼šæ‰¹é‡è‡ªåŠ¨æ·»åŠ 

### 2. AI èŠå¤©å¯¹è¯ - å¨æˆ¿ç®¡å®¶

```typescript
import { sendChatMessage } from "./services/aiService";

const response = await sendChatMessage(
  history, 
  "æ¨èä¸€é“èœ", 
  inventory, 
  recipes
);
```

**ç‰¹æ€§:**
- âœ… åŸºäºå†°ç®±åº“å­˜æ¨èé£Ÿè°±
- âœ… ä¼˜å…ˆæ¶ˆè€—å³å°†è¿‡æœŸçš„é£Ÿæ
- âœ… å‡å°‘é£Ÿç‰©æµªè´¹çš„å»ºè®®
- âœ… æ­£å¿µçƒ¹é¥ªæŒ‡å¯¼

## ä½¿ç”¨æ–¹æ³•

```typescript
import { analyzeImage, sendChatMessage } from "./services/aiService";
import { ItemType } from "./types";

// å›¾åƒåˆ†æ - æ”¯æŒè¯†åˆ«å¤šä¸ªé£Ÿæ
const result = await analyzeImage(base64Image, ItemType.FRIDGE);
console.log(`è¯†åˆ«åˆ° ${result.totalCount} ä¸ªé£Ÿæ`);
result.items.forEach(item => {
  console.log(`- ${item.name} (${item.category})`);
});

// èŠå¤©
const response = await sendChatMessage(history, message, inventory, recipes);
```

## ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env.local` ä¸­è®¾ç½®ï¼š

```bash
# å¿…éœ€
ZENMUX_API_KEY=sk-ai-v1-your-api-key

# å¯é€‰ (é»˜è®¤: vertex-ai)
ZENMUX_PROVIDER=vertex-ai    # æˆ– "openai"

# å¯é€‰ (é»˜è®¤: google/gemini-3-pro-preview-free)
ZENMUX_MODEL=google/gemini-3-pro-preview-free
```

## åˆ‡æ¢æä¾›å•†

### ä½¿ç”¨ Vertex AI (é»˜è®¤)
```bash
ZENMUX_PROVIDER=vertex-ai
```

### ä½¿ç”¨ OpenAI SDK
```bash
ZENMUX_PROVIDER=openai
```

## âœ¨ æ¶æ„ä¼˜åŠ¿

- âœ… **åˆ†å±‚æ¸…æ™°** - ä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€èƒ½åŠ›åˆ†ç¦»
- âœ… **æ— é‡å¤ä»£ç ** - Prompt/Schema ç»Ÿä¸€ç®¡ç†
- âœ… **æ˜“äºæµ‹è¯•** - æ¯å±‚å¯ç‹¬ç«‹æµ‹è¯•
- âœ… **æ˜“äºæ‰©å±•** - æ·»åŠ æ–°æä¾›å•†åªéœ€å®ç°åŸºç¡€èƒ½åŠ›å±‚
- âœ… **èŒè´£å•ä¸€** - æ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä»¶äº‹
- âœ… **å¯ç»´æŠ¤** - ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ä¸å½±å“ AI è°ƒç”¨
- âœ… **å¤šç‰©å“è¯†åˆ«** - è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ä¸­çš„æ‰€æœ‰é£Ÿæ
- âœ… **ZenKitchen ä¸“æ³¨** - ä¸“ä¸ºå¨æˆ¿ç®¡ç†ä¼˜åŒ–

## ğŸ”§ æ‰©å±•æ–°çš„ AI æä¾›å•†

åªéœ€ 3 æ­¥ï¼š

1. åˆ›å»ºæ–°çš„åŸºç¡€èƒ½åŠ›æ–‡ä»¶ (å¦‚ `anthropic.ts`)
2. å®ç° `analyzeImageJSON()` å’Œ `chat()` å‡½æ•°
3. åœ¨ `aiService.ts` ä¸­æ·»åŠ è·¯ç”±é€»è¾‘

ä¸šåŠ¡é€»è¾‘å®Œå…¨å¤ç”¨ï¼Œæ— éœ€ä¿®æ”¹ï¼
